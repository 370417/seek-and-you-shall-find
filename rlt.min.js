var rlt={}
rlt.dir4=[[1,0],[-1,0],[0,1],[0,-1]],rlt.dir8=[[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1],[0,1],[1,1]],rlt.dir9=[[1,-1],[0,-1],[-1,-1],[1,0],[0,0],[-1,0],[1,1],[0,1],[-1,1]],rlt.clamp=function(t,r,e){return void 0!==r&&r>t?r:void 0!==e&&t>e?e:t},rlt.shadowcast=function(t,r,e,i){"use strict"
var n=function(a,l,h,o){if(!(l>=h)){for(var s=Math.round((a-.5)*l),f=Math.ceil((a+.5)*h-.5),c=s;f>=c;c++){var u=t+o.xx*c+o.xy*a,d=r+o.yx*c+o.yy*a
if(e(u,d))c>=a*l&&a*h>=c&&i(u,d)
else if(c>=(a-.5)*l&&a*h>=c-.5&&i(u,d),n(a+1,l,(c-.5)/a,o),l=(c+.5)/a,l>=h)return}n(a+1,l,h,o)}},a=[{xx:1,xy:0,yx:0,yy:1},{xx:1,xy:0,yx:0,yy:-1},{xx:-1,xy:0,yx:0,yy:1},{xx:-1,xy:0,yx:0,yy:-1},{xx:0,xy:1,yx:1,yy:0},{xx:0,xy:1,yx:-1,yy:0},{xx:0,xy:-1,yx:1,yy:0},{xx:0,xy:-1,yx:-1,yy:0}]
i(t,r)
for(var l=0;8>l;l++)n(1,0,1,a[l])},rlt.linecast=function(t,r,e,i,n,a){"use strict"
var l=Math.abs(e-t),h=Math.abs(i-r)
if(0===l&&0===h)return void a(t,r)
for(var o=e>t?1:-1,s=i>r?1:-1,f=l-h;;){if(a(t,r),!n(t,r))break
var c=2*f
c>=-l&&(f-=h,t+=o),l>=c&&(f+=l,r+=s)}},rlt.Schedule=function(){"use strict"
return{add:function(t,r){for(var e=this,i=this.next;i&&i.delta<=r;)r-=i.delta,e=i,i=i.next
return i&&(i.delta-=r),e.next={actor:t,delta:r,next:i},this},advance:function(){if(this.next){var t=this.next.actor
return this.next=this.next.next,t}},remove:function(t){for(var r=this,e=this.next;e;)e.actor===t?(r.next=e.next,r.next&&(r.next.delta+=e.delta)):r=r.next,e=r.next
return this},next:void 0}},rlt.loadImg=function(t,r,e,i){"use strict"
var n
return n="number"==typeof e&&"number"==typeof i?new Image(e,i):new Image,n.addEventListener("load",r),n.src=t,n},rlt.random=function(t,r,e){"use strict"
return e=e||Math.random,t+Math.floor((1+r-t)*e())},rlt.shuffle=function(t,r){"use strict"
r=r||Math.random
for(var e=t.length-1;e>0;e--){var i=Math.floor(e*r()),n=t[e]
t[e]=t[i],t[i]=n}return t},rlt.range=function(t){"use strict"
for(var r=[],e=0;t>e;e++)r[e]=e
return r},rlt.binarySearchInterval=function(t,r){"use strict"
for(var e=0,i=t.length-1,n=Math.floor((e+i)/2);n>e;)if(t[n]<r)e=n,n=Math.floor((n+i)/2)
else{if(!(t[n]>r))return n
i=n,n=Math.floor((e+n)/2)}return r<t[n]?0:n+1},rlt.randomIndex=function(t,r,e){"use strict"
if(r=r||Math.random,!e)for(var i=1;i<t.length;i++)t[i]+=t[i-1]
var n=t[t.length-1],a=n*r()
return rlt.binarySearchInterval(t,a)},rlt.array2d=function(t,r,e){"use strict"
for(var i=[],n=0;t>n;n++){i[n]=[]
for(var a=0;r>a;a++)"function"==typeof e?i[n][a]=e(n,a):i[n][a]=e}return i},rlt.arrayMax=function(t){"use strict"
for(var r,e=-(1/0),i=0;i<t.length;i++)t[i]>e&&(r=i,e=t[i])
return r},rlt.normalize2d=function(t){"use strict"
for(var r=0,e=0;e<t.length;e++)for(var i=0;i<t[0].length;i++)t[e][i]>r&&(r=t[e][i])
for(var e=0;e<t.length;e++)for(var i=0;i<t[0].length;i++)t[e][i]/=r
return t},rlt.shuffledRange=function(t,r){"use strict"
r=r||Math.random
for(var e=[],i=0;t>i;i++){var n=Math.floor(i*r())
n!==i&&(e[i]=e[n]),e[n]=i}return e},rlt.distance=function(t,r,e,i){"use strict"
var n=Math.max(Math.abs(e-t),Math.abs(i-r)),a=Math.min(Math.abs(e-t),Math.abs(i-r))
return n+a/2},rlt.astar=function(t,r,e,i,n){"use strict"
for(var n=n||rlt.dir8,a=[{parent:void 0,x:t,y:r,f:0,g:0,h:0}],l=[];a.length>0;){for(var h=0,o=a[0].f,s=1;s<a.length;s++)a[s].f<o&&(h=s,o=a[s].f)
for(var f=a.splice(h,1)[0],s=0;s<n.length;s++){var c=f.x+n[s][0],u=f.y+n[s][1]
if(!(e(c,u)<=0)){var d={parent:f,x:c,y:u,g:f.g+e(c,u),h:i(c,u)}
if(d.f=d.g+d.h,i(c,u)<=0)return d
for(var x=!1,y=0;y<a.length;y++)a[y].x===d.x&&a[y].y===d.y&&a[y].f<=d.f&&(x=!0)
for(var y=0;y<l.length;y++)l[y].x===d.x&&l[y].y===d.y&&l[y].f<=d.f&&(x=!0)
x||a.push(d)}}l.push(f)}return l},rlt.floodfill=function(t,r,e,i,n){"use strict"
for(var a=0;a<n.length;a++){var l=t+n[a][0],h=r+n[a][1]
i(l,h)&&(e(l,h),rlt.floodfill(l,h,e,i,n))}},rlt._measureFont=function(t,r){"use strict"
r=r||"@"
var e=document.createElement("div")
e.innerHTML=r,e.style.position="absolute",e.style.font=t,document.body.appendChild(e)
var i=e.offsetWidth,n=e.offsetHeight
return document.body.removeChild(e),{width:i,height:n}},rlt.arr2rgb=function(t){"use strict"
return 3===t.length?"rgb("+t[0]+","+t[1]+","+t[2]+")":4===t.length?"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")":""},rlt.arr2hsl=function(t){"use strict"
return 3===t.length?"hsl("+t[0]+","+t[1]+"%,"+t[2]+"%)":4===t.length?"hsl("+t[0]+","+t[1]+"%,"+t[2]+"%,"+t[3]+")":""},rlt._isTransparent=function(t){"use strict"
return t?"transparent"===t?!0:!1:!0},rlt.Display=function(t){"use strict"
t=t||{}
var r=Object.create(rlt.Display.prototype)
r.width=t.width||80,r.height=t.height||24,r.font=t.font||"1em/1 monospace",r.canvas=t.canvas
var e=rlt._measureFont(r.font,"@")
if(r.tileWidth=t.tileWidth||e.width,r.tileHeight=t.tileHeight||e.height,!r.canvas){var i=document.createElement("canvas")
i.width=r.width*r.tileWidth,i.height=r.height*r.tileHeight,r.canvas=i}return r.ctx=r.canvas.getContext("2d"),r.ctx.font=r.font,r.ctx.textAlign="center",r.ctx.textBaseline="middle",r},rlt.Display.prototype.draw=function(t,r,e,i,n){"use strict"
"object"==typeof i&&(i=rlt.arr2rgb(i)),"object"==typeof n&&(n=rlt.arr2rgb(n)),rlt._isTransparent(n)||(this.ctx.fillStyle=n,this.ctx.fillRect(r*this.tileWidth,e*this.tileHeight,this.tileWidth,this.tileHeight)),rlt._isTransparent(i)||(this.ctx.fillStyle=i,this.ctx.fillText(t,(r+.5)*this.tileWidth,(e+.5)*this.tileHeight))},rlt.Display.prototype.drawCached=function(t,r,e){"use strict"
this.ctx.drawImage(t,r*this.tileWidth,e*this.tileHeight)},rlt.Display.prototype.drawBitmap=function(t,r,e,i,n,a,l,h){"use strict"
var o=document.createElement("canvas")
o.width=i,o.height=n
var s=o.getContext("2d")
s.drawImage(t,r*i,e*n,i,n,0,0,o.width,o.height),h&&(s.globalCompositeOperation="source-in",s.fillStyle=h,s.fillRect(0,0,o.width,o.height)),this.ctx.drawImage(o,a*this.tileWidth,l*this.tileHeight)},rlt.Display.prototype.drawBg=function(t,r,e){"use strict"
this.ctx.fillStyle=t,this.ctx.fillRect(r*this.tileWidth,e*this.tileHeight,this.tileWidth,this.tileHeight)}